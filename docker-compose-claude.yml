services:
  claude:
    image: claude
    user: "${UID:-1000}:${GID:-1000}"
    volumes:
      - ${CODE_MOUNT}:/home/node/dev
      # don't allow changing git hooks
      - ${CODE_MOUNT}/.git/hooks:/home/node/dev/.git/hooks:ro
      # separate /target dir since it is easy to hide things there
      - rust_target:/home/node/dev/target
      # keep .cargo for speed
      - cargo_cache:/home/node/.cargo
      # these are for keeping claude logged in
      - claude_data:/home/node/.claude
      - ${HOME}/.claude.json:/home/node/.claude.json
      - ${HOME}/.config/claude-code/auth.json:/home/node/.config/claude-code/auth.json
      # optional: for git authentication without exposing ssh keys
      #- ${SSH_AUTH_SOCK}:/ssh-agent
      #- ${HOME}/.gitconfig:/home/node/.gitconfig:ro
    # don't allow chown or chgrp
    security_opt:
      - no-new-privileges:true
    cap_drop: [ALL]
    # Keeps the container running and allows interactive terminal
    stdin_open: true
    tty: true
    environment:
      - TERM=xterm-256color # Fancy colors
      #- SSH_AUTH_SOCK=/ssh-agent
    command: tail -f /dev/null

volumes:
  rust_target:
  cargo_cache:
  claude_data:
